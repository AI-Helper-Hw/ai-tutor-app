<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tutor - Homework Helper</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Math & Markdown Libraries -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- App Container -->
    <div class="app-container">
        
        <!-- SIDEBAR (History) -->
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <button id="new-chat-btn" class="new-chat-btn">
                    <i class="fas fa-plus"></i> New Doubt
                </button>
            </div>
            
            <div id="history-list" class="history-list">
                <!-- Saved chats will appear here -->
            </div>
            
            <div class="sidebar-footer">
                <!-- NEW: User Profile Section (Hidden until logged in) -->
                <div id="user-profile" class="user-profile" style="display: none;">
                    <img id="user-avatar" src="" alt="Profile">
                    <span id="user-name-display">User</span>
                </div>

                <!-- NEW: Login/Logout Buttons -->
                <button id="login-sidebar-btn" class="footer-link">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <button id="logout-btn" class="footer-link" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>

                <!-- ORIGINAL Buttons -->
                <button id="feedback-btn" class="footer-link">
                    <i class="fas fa-comment-dots"></i> Send Feedback
                </button>
                <button id="clear-all-btn" class="footer-link">
                    <i class="fas fa-trash-alt"></i> Clear All
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT (Chat) -->
        <main class="main-content">
            <!-- Header -->
            <header class="app-header">
                <div class="header-left">
                    <button id="menu-btn" class="icon-btn mobile-only">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="brand">
                        <i class="fas fa-graduation-cap"></i>
                        <span>AI Helper</span>
                    </div>
                </div>
                
                <!-- NEW: Free Chat Counter -->
                <div class="header-right">
                    <span id="chat-counter" class="chat-counter">Free Chats: 10</span>
                </div>
            </header>

            <!-- Chat History Area -->
            <div id="chat-history">
                <!-- Messages load here -->
            </div>

            <!-- Input Area -->
            <div class="input-container">
                <div id="file-preview-area"></div>
                
                <form id="chat-form" class="input-box">
                    <label for="image-upload" class="upload-btn" id="upload-label" title="Scan Question">
                        <i class="fas fa-camera fa-lg"></i>
                    </label>
                    <input type="file" id="image-upload" accept="image/*">

                    <textarea id="user-input" rows="1" placeholder="Type a question..." required></textarea>

                    <button type="submit" class="send-btn" id="submit-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </main>
        
        <!-- Overlay for mobile sidebar -->
        <div id="overlay" class="overlay"></div>
    </div>

    <!-- ORIGINAL: Feedback Modal -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>ðŸ“¬ Send Feedback</h2>
            <p>Help us improve! Share your thoughts, report issues, or request features.</p>
            
            <form id="feedbackForm">
                <div class="form-group">
                    <label for="user-name">Your Name *</label>
                    <input type="text" id="user-name" required placeholder="Enter your name">
                </div>
                
                <div class="form-group">
                    <label for="user-email">Your Email *</label>
                    <input type="email" id="user-email" required placeholder="your@email.com">
                </div>
                
                <div class="form-group">
                    <label for="feedback-message">Feedback *</label>
                    <textarea id="feedback-message" rows="5" required placeholder="Tell us what you think, what's broken, or what features you'd like..."></textarea>
                </div>
                
                <button type="submit" class="submit-feedback-btn">
                    <i class="fas fa-paper-plane"></i> Send Feedback
                </button>
            </form>
            
            <div id="feedback-status" class="feedback-status"></div>
        </div>
    </div>

    <!-- NEW: Login Popup Modal -->
    <div id="loginModal" class="modal login-modal">
        <div class="modal-content login-content">
            <!-- The 'X' Button (Will be hidden when limit reached) -->
            <span id="close-login-btn" class="close-modal">&times;</span>
            
            <div class="login-header">
                <div class="icon-circle">
                    <i class="fas fa-robot"></i>
                </div>
                <h2>Welcome to AI Tutor</h2>
                <p>Sign in to save your history and get unlimited help.</p>
            </div>

            <button id="google-login-btn" class="google-btn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google G">
                <span>Continue with Google</span>
            </button>

            <p class="terms-text">
                10 Free chats for guests. Unlimited for users.
            </p>
        </div>
    </div>

    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- MAIN SCRIPT (Must be type="module" for Firebase) -->
    <script type="module" src="script.js"></script>
</body>
</html>